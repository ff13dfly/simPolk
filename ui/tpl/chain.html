<div class="row">
    <div class="col-lg-7  gy-4">
        <div class="row">
            <div class="col-lg-7">
                <small>Block height</small>
                <h2 id="block_current" class="text-primary"></h2>
                <small id="server_current"></small>
            </div>

            <div class="col-lg-5 text-end  gy-4">
                <button class="btn btn-lg btn-primary" id="collected_clean">Clean collected</button>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <hr>
            </div>
            <div class="col-lg-9">
                <h4>Collected Transfer List</h4>
            </div>
        </div>
        <div class="row" id="collected_transfer">

        </div>

        <div class="row">
            <div class="col-lg-12">
                <hr>
            </div>
            <div class="col-lg-9">
                <h4>Collected Storage List</h4>
            </div>
        </div>
        <div class="row" id="collected_storage">

        </div>

        <div class="row">
            <div class="col-lg-12">
                <hr>
            </div>
            <div class="col-lg-9">
                <h4>Collected Contact List</h4>
            </div>
        </div>
        <div class="row" id="collected_contact">

        </div>
    </div>
    <div class="col-lg-1  gy-4"></div>
    <div class="col-lg-4  gy-4">
        <div class="row">
            <div class="col-lg-12">
                <label for="block_num">Block number</label>
                <input type="text" class="form-control" name="block_num" id="block_num" value="">
            </div>
            <div class="col-lg-12 text-end gy-4">
                <button class="btn btn-lg btn-primary" id="block_view">View Block Data</button>
            </div>
        </div>

        <div class="row text-break" id="block_info">

        </div>
    </div>
</div>

<script type="text/javascript">
    var self = {
        domList: function(list) {
            var dom = '';
            for (var k in list) {
                var row = list[k];
                dom += '<div class="col-lg-1">' + k + '</div>' + '<div class="col-lg-11 text-break">' + row + '</div>'
            }
            return dom;
        },
        domMerkle: function(arr) {
            var dom = '';
            for (var k in arr) {
                var row = arr[k];
                dom += '<div class="col-lg-1">' + k + '</div>' + '<div class="col-lg-11 text-break">' + row + '</div>'
            }
            return dom;
        },
        domObject: function(obj) {
            var dom = '';
            for (var k in obj) {
                var row = JSON.stringify(obj[k]);
                dom += `<div class="col-lg-4 text-break" >${k}</div><div class="col-lg-8 text-break" >${row}</div>`;
            }
            return dom;
        }
    }
    $(function() {
        simPolk.request('chain', 'current', {}, function(res) {
            $('#block_current').html(res.current.current_block);
            $('#server_current').html(res.current.server.url);

            var tdom = self.domList(res.transfer.data);
            var mtree = '<h5>Merkle tree</h5>' + self.domMerkle(res.transfer.merkle)
            $('#collected_transfer').html(tdom).append(mtree);

            var sdom = self.domList(res.storage.data);
            var stree = '<h5>Merkle tree</h5>' + self.domMerkle(res.storage.merkle);
            $('#collected_storage').html(sdom).append(stree);

            var cdom = self.domList(res.contact.data);
            var ctree = '<h5>Merkle tree</h5>' + self.domMerkle(res.contact.merkle);
            $('#collected_contact').html(cdom).append(ctree);
        });
    });


    $('#block_view').off('click').on('click', function() {
        var num = parseInt($('#block_num').val());
        if (isNaN(num)) return false;
        simPolk.request('chain', 'view', {
            n: num
        }, function(res) {
            if (!res.success) return false;
            var ctx = !res.data ? 'No block data.' : self.domObject(res.data);
            $('#block_info').html(ctx);
        });
    });

    $('#collected_clean').off('click').on('click', function() {
        simPolk.request('chain', 'clean', {}, function(res) {
            if (!res.success) return false;
            location.reload();
        });
    });
</script>